---
import GithubIcon from "@icons/GithubIcon.astro"
import LinkedIn from "@icons/LinkedIn.astro"
import Mail from "@icons/Mail.astro"
import Menu from "@icons/Menu.astro"
import Moon from "@icons/Moon.astro"
---

<header
  id="navbar"
  class="w-[95%] sm:w-full sticky top-5 left-0 z-50 px-0 sm:max-w-[920px] mx-auto bg-[#151519] sm:bg-[#15151990] border border-gray-700 backdrop-blur-3xl transition-all duration-300 rounded-md overflow-hidden"
>
  <nav class="flex flex-col sm:flex-row items-center mx-auto p-2">
    <div class="sm:hidden flex justify-between items-center w-full sm:w-auto">
      <!-- Logo -->
      <a
        href="/"
        class="home-link text-lg font-medium text-gray-400 hover:text-white transition-colors duration-300 pl-2"
      >
        oussamaati.dev
      </a>

      <!-- Mobile Menu Button -->
      <button
        id="menu-button"
        class="p-2 text-white hover:bg-gray-800 rounded-md transition-colors duration-300"
      >
        <Menu class="size-6" />
        <!-- <Close class="size-6" /> -->
      </button>
    </div>

    <!-- Main Navigation and Social Links -->
    <div
      id="nav-content"
      class="hidden flex-col items-center w-full mt-4 sm:mt-0 sm:flex sm:flex-row sm:justify-between"
    >
      <!-- Logo -->
      <a
        href="/"
        class="hidden sm:block home-link font-medium text-gray-400 hover:text-white transition-colors duration-300 pl-2"
      >
        oussamaati.dev
      </a>
      <div class="flex flex-col sm:flex-row gap-2 items-center">
        <a
          href="#about"
          class="p-2 text-sm text-white w-full hover:bg-gray-800 bg-gray-800 sm:bg-transparent rounded-md transition-colors duration-300"
          >About</a
        >
        <a
          href="#experience"
          class="p-2 text-sm text-white w-full hover:bg-gray-800 bg-gray-800 sm:bg-transparent rounded-md transition-colors duration-300"
          >Experience</a
        >
        <a
          href="#projects"
          class="p-2 text-sm text-white w-full hover:bg-gray-800 bg-gray-800 sm:bg-transparent rounded-md transition-colors duration-300"
          >Projects</a
        >
        <a
          href="#certifications"
          class="p-2 text-sm text-white w-full hover:bg-gray-800 bg-gray-800 sm:bg-transparent rounded-md transition-colors duration-300"
          >Certifications</a
        >
        <a
          href="#skills"
          class="p-2 text-sm text-white w-full hover:bg-gray-800 bg-gray-800 sm:bg-transparent rounded-md transition-colors duration-300"
          >Skills</a
        >
      </div>

      <div class="flex gap-1 items-center mt-4 sm:mt-0">
        <a
          href="mailto:oussamaati03@gmail.com"
          aria-label="Email"
          class="p-2 text-white hover:bg-gray-800 rounded-md transition-colors duration-300"
        >
          <Mail class="size-6" />
        </a>
        <a
          href="#"
          aria-label="Dark Mode"
          class="p-2 text-white hover:bg-gray-800 rounded-md transition-colors duration-300"
        >
          <Moon class="size-6" />
        </a>
        <a
          href="https://github.com/OussamaAtifii"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="GitHub Profile"
          class="p-2 text-white hover:bg-gray-800 rounded-md transition-colors duration-300"
        >
          <GithubIcon class="size-[18px]" />
        </a>
        <a
          href="https://www.linkedin.com/in/oussama-atifi/"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="LinkedIn Profile"
          class="p-2 text-white hover:bg-gray-800 rounded-md transition-colors duration-300"
        >
          <LinkedIn class="size-[18px]" />
        </a>
      </div>
    </div>
  </nav>
</header>

<script>
  const menuButton = document.getElementById("menu-button")
  const navContent = document.getElementById("nav-content")

  let lastScrollY = window.scrollY
  let ticking = false
  const threshold = 10 // Quantity of pixels to trigger the scroll event
  let isScrollDisabled = false // Flag to disable scroll while interacting with the menu
  let isMenuOpen = false

  const handleNavScroll = () => {
    if (!ticking && !isScrollDisabled) {
      // Only execute if scroll is not disabled
      window.requestAnimationFrame(() => {
        const navbar = document.getElementById("navbar")

        // Only execute if the quantity of pixels scrolled is greater than the threshold
        if (Math.abs(window.scrollY - lastScrollY) > threshold) {
          if (window.scrollY > lastScrollY) {
            navbar?.classList.add("hidden") // Hide when scrolling down
          } else {
            navbar?.classList.remove("hidden") // Show when scrolling up
          }

          // Update the last scroll position
          lastScrollY = window.scrollY
        }

        ticking = false
      })
      ticking = true
    }
  }

  menuButton?.addEventListener("click", () => {
    isMenuOpen = !isMenuOpen

    // Disable scroll temporarily while interacting with the menu
    isScrollDisabled = true

    // Change menu visibility
    navContent?.classList.toggle("hidden")
    document.body.classList.toggle("overflow-hidden")

    // Cambia el ícono del menú dinámicamente
    menuButton.innerHTML = isMenuOpen
      ? '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" width="20" height="20" stroke-width="1.5" > <path d="M18 6l-12 12"></path> <path d="M6 6l12 12"></path></svg>'
      : '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" width="20" height="20" stroke-width="1.5"> <path d="M4 8l16 0"></path> <path d="M4 16l16 0"></path </svg>'

    // Re-enable scroll
    setTimeout(() => {
      isScrollDisabled = false
    }, 300)
  })

  const links = navContent?.querySelectorAll("a")

  // Close the menu when clicking on a link
  links?.forEach((link) => {
    link.addEventListener("click", () => {
      setTimeout(() => {
        navContent?.classList.add("hidden")
      }, 100)
    })
  })

  document.addEventListener("scroll", handleNavScroll)
</script>
